# ๐ฏ **ุชุญุณููุงุช ุงูุฏุงุดุจูุฑุฏ - ุชูุฑูุฑ ุดุงูู**

## ๐ **ุงูุชุงุฑูุฎ:** 2025-10-10

---

## โ **ููุฎุต ุงูุชุญุณููุงุช ุงููููุฐุฉ**

ุชู ุชูููุฐ **6 ุชุญุณููุงุช ุฑุฆูุณูุฉ** ุนูู ุชุทุจูู ุงูุฏุงุดุจูุฑุฏ ูุชุญุณูู ุฅุฏุงุฑุฉ ุงููุฑูุน ุงููุชุนุฏุฏุฉ ูุชุฌุฑุจุฉ ุงููุณุชุฎุฏู:

| # | ุงูุชุญุณูู | ุงูุญุงูุฉ |
|---|---------|--------|
| 1 | ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู - ููุชุฑุฉ ุญุณุจ ุงููุฑุน | โ ููุชูู |
| 2 | ุงูุญุณุงุจุงุช ุงูุฌุฏูุฏุฉ - ูุธุงู ุงููุฑุงุฌุนุฉ | โ ููุชูู |
| 3 | ุฅุฏุงุฑุฉ ุงูููุชุฌุงุช - ุฅุดุนุงุฑุงุช ูุฎุตุตุฉ | โ ููุชูู |
| 4 | ุดุงุดุฉ ุงูุทูุจุงุช - ููุชุฑุฉ ุญุณุจ closestBranch | โ ููุชูู |
| 5 | ุดุงุดุฉ ุงูุฅุดุนุงุฑุงุช - ุชุญุณูู OneSignal | โ ููุชูู |
| 6 | ุงูุฅุญุตุงุฆูุงุช - ุฌุนููุง ูุงูุนูุฉ | โ ููุชูู |

---

## 1๏ธโฃ **ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู - ููุชุฑุฉ ุญุณุจ ุงููุฑุน**

### **ุงููุดููุฉ:**
- ูุงูุช ุดุงุดุฉ ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู ุชุนุฑุถ ุฌููุน ุงููุณุชุฎุฏููู ุจุบุถ ุงููุธุฑ ุนู ุงููุฑุน ุงููุฎุชุงุฑ.

### **ุงูุญู:**
โ **ุชู ุฅุถุงูุฉ ููุชุฑุฉ ุชููุงุฆูุฉ ุญุณุจ ุงููุฑุน ุงููุฎุชุงุฑ**

#### **ุงููููุงุช ุงูููุนุฏููุฉ:**

##### **1. `dashboard_app/lib/services/user_service.dart`**
```dart
// ุฅุถุงูุฉ ุฏุนู ุงูููุชุฑุฉ ุญุณุจ ุงููุฑุน
static Future<List<UserModel>> getAllUsers({String? branch}) async {
  Query query = _db.collection(_collection);
  
  if (branch != null && branch.isNotEmpty && branch != 'ุงูุนุฑุงู') {
    query = query.where('closestBranch', isEqualTo: branch);
  }
  
  // ุฌูุจ ุงููุณุชุฎุฏููู
  final querySnapshot = await query.get();
  // ...
}

// ุชุญุฏูุซ ุฅุญุตุงุฆูุงุช ุงููุณุชุฎุฏููู
static Future<Map<String, int>> getUserStats({String? branch}) async {
  // ููุชุฑุฉ ุญุณุจ ุงููุฑุน
  if (branch != null && branch.isNotEmpty && branch != 'ุงูุนุฑุงู') {
    allQuery = allQuery.where('closestBranch', isEqualTo: branch);
    // ...
  }
}
```

##### **2. `dashboard_app/lib/controllers/user_controller.dart`**
```dart
@override
void onInit() {
  super.onInit();
  final branchController = Get.find<BranchController>();
  
  // ุฌูุจ ุงููุณุชุฎุฏููู ุญุณุจ ุงููุฑุน ุงููุฎุชุงุฑ
  loadAllUsers(branch: branchController.selectedBranch.value);
  
  // ุงูุงุณุชูุงุน ูุชุบููุฑ ุงููุฑุน ูุชุญุฏูุซ ุงูุจูุงูุงุช ุชููุงุฆูุงู
  branchController.selectedBranch.listen((branch) {
    loadAllUsers(branch: branch);
    loadUserStats(branch: branch);
  });
}
```

##### **3. `dashboard_app/lib/models/user_model.dart`**
```dart
// ุฅุถุงูุฉ ุญูู closestBranch
final String? closestBranch; // ุงููุฑุน ุงูุฃูุฑุจ
```

### **ุงููุชูุฌุฉ:**
- โ ูุนุฑุถ ููุท ูุณุชุฎุฏูู ุงููุฑุน ุงููุฎุชุงุฑ
- โ ูุชุญุฏุซ ุชููุงุฆูุงู ุนูุฏ ุชุบููุฑ ุงููุฑุน
- โ "ุงูุนุฑุงู" ูุนุฑุถ ุฌููุน ุงููุณุชุฎุฏููู

---

## 2๏ธโฃ **ุงูุญุณุงุจุงุช ุงูุฌุฏูุฏุฉ - ูุธุงู ุงููุฑุงุฌุนุฉ**

### **ุงููุตู:**
ูุธุงู ุงููุฑุงุฌุนุฉ **ูุนูู ุจุดูู ุตุญูุญ ุจุงููุนู**:

### **ุงููุธุงุฆู ุงูููุฌูุฏุฉ:**
- โ ุนุฑุถ ุฌููุน ุงูุญุณุงุจุงุช ุงูุฌุฏูุฏุฉ ุบูุฑ ุงููุฑุงุฌุนุฉ (`isReviewed: false`)
- โ ุฒุฑ "ุชูุช ุงููุฑุงุฌุนุฉ" ูุชุฃููุฏ ุงููุฑุงุฌุนุฉ
- โ ุฅุฎูุงุก ุงููุณุชุฎุฏู ูู ุงูุดุงุดุฉ ุจุนุฏ ุงููุฑุงุฌุนุฉ
- โ **ูุง ูุคุซุฑ ุนูู ุญุงูุฉ ุงููุณุชุฎุฏู - ููุท ููุฅุทูุงุน**

### **ุงูููุฏ ุงูููุฌูุฏ:**
```dart
// ูู user_service.dart
static Future<List<UserModel>> getNewUsers() async {
  final querySnapshot = await _db
      .collection(_collection)
      .where('isReviewed', isEqualTo: false)
      .get();
  // ...
}

static Future<bool> markAsReviewed(String userId) async {
  await _db.collection(_collection).doc(userId).update({
    'isReviewed': true,
    'updatedAt': FieldValue.serverTimestamp(),
  });
  return true;
}
```

### **ุงููุชูุฌุฉ:**
- โ ูุธุงู ุงููุฑุงุฌุนุฉ ูุนูู ููุง ูู ูุทููุจ
- โ ุงูุญุณุงุจุงุช ุงูุฌุฏูุฏุฉ ุชุธูุฑ ุญุชู ุงููุฑุงุฌุนุฉ
- โ ุจุนุฏ ุงููุฑุงุฌุนุฉ ุชุฎุชูู ูู ุงููุงุฆูุฉ

---

## 3๏ธโฃ **ุฅุฏุงุฑุฉ ุงูููุชุฌุงุช - ุฒุฑ ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ูุฎุตุตุฉ**

### **ุงูููุฒุฉ ุงูุฌุฏูุฏุฉ:**
โ **ุฒุฑ ุฌุฏูุฏ ูุฅุฑุณุงู ุฅุดุนุงุฑุงุช ูุฎุตุตุฉ ุญุณุจ ุงููุฑุน**

### **ุงููุธุงุฆู:**
1. **ุงุฎุชูุงุฑ ุงููุฑุน** ูู ูุงุฆูุฉ ููุณุฏูุฉ:
   - ุงูุบุฒุงููุฉ ๐ข
   - ุงูุฒุนูุฑุงููุฉ ๐ช
   - ุงูุงุนุธููุฉ ๐ฌ
   - ุงูุนุฑุงู ๐ฎ๐ถ (ุฌููุน ุงููุฑูุน)

2. **ูุชุงุจุฉ ุฑุณุงูุฉ ูุฎุตุตุฉ**

3. **ุฅุฑุณุงู ุงูุฅุดุนุงุฑ** ููุท ููุณุชุฎุฏูู ุงููุฑุน ุงููุฎุชุงุฑ

### **ุงููููุงุช ุงูููุถุงูุฉ:**

##### **`dashboard_app/lib/views/products_management_screen.dart`**
```dart
// ุฒุฑ ุฌุฏูุฏ ูู AppBar
IconButton(
  icon: Icon(Icons.notifications_active),
  tooltip: 'ุฅุฑุณุงู ุฅุดุนุงุฑ ูุฎุตุต',
  onPressed: () => _showCustomNotificationDialog(),
),

// ูุงูุฐุฉ ุญูุงุฑ ูุฎุตุตุฉ
void _showCustomNotificationDialog() {
  // ุงุฎุชูุงุฑ ุงููุฑุน
  DropdownButton<String>(
    value: selectedBranch.value,
    items: BranchController.branches.map((String branch) {
      // ...
    }).toList(),
  ),
  
  // ุญูู ูุชุงุจุฉ ุงูุฑุณุงูุฉ
  TextField(
    controller: messageController,
    maxLines: 4,
    decoration: InputDecoration(
      hintText: 'ุงูุชุจ ุฑุณุงูุชู ููุง...',
    ),
  ),
  
  // ุฅุฑุณุงู ุงูุฅุดุนุงุฑ
  await notificationController.sendToAllUsers(
    title: 'ุฅุดุนุงุฑ ูู VCenter',
    message: messageController.text.trim(),
    branch: selectedBranch.value == 'ุงูุนุฑุงู' ? null : selectedBranch.value,
  );
}
```

### **ุงููุชูุฌุฉ:**
- โ ุฒุฑ ูุงุถุญ ูู ุดุงุดุฉ ุงูููุชุฌุงุช
- โ ูุงุฌูุฉ ุจุณูุทุฉ ูุณููุฉ ุงูุงุณุชุฎุฏุงู
- โ ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ูุณุชูุฏูุฉ ุญุณุจ ุงููุฑุน

---

## 4๏ธโฃ **ุดุงุดุฉ ุงูุทูุจุงุช - ููุชุฑุฉ ุญุณุจ closestBranch**

### **ุงูุชุญุณูู:**
โ **ุชู ุชูุนูู ุงูููุชุฑุฉ ุจุงููุนู ูู ุงููุธุงู**

### **ุงูููุฏ ุงูููุทุจู:**
```dart
// ูู order_service.dart
static Future<List<OrderModel>> getAllOrders({String? branch}) async {
  Query query = _db.collection(_collection);
  
  if (branch != null && branch.isNotEmpty) {
    query = query.where('closestBranch', isEqualTo: branch);
  }
  
  final querySnapshot = await query.get();
  // ...
}

// ูู order_controller.dart
@override
void onInit() {
  final branchController = Get.find<BranchController>();
  fetchOrders(branch: branchController.selectedBranch.value);
  
  // ุชุญุฏูุซ ุชููุงุฆู ุนูุฏ ุชุบููุฑ ุงููุฑุน
  branchController.selectedBranch.listen((branch) {
    fetchOrders(branch: branch);
  });
}
```

### **ุงููุชูุฌุฉ:**
- โ ุชุนุฑุถ ููุท ุทูุจุงุช ุงููุฑุน ุงููุฎุชุงุฑ
- โ ุชุชุญุฏุซ ุชููุงุฆูุงู ุนูุฏ ุชุบููุฑ ุงููุฑุน
- โ "ุงูุนุฑุงู" ูุนุฑุถ ุฌููุน ุงูุทูุจุงุช

---

## 5๏ธโฃ **ุดุงุดุฉ ุงูุฅุดุนุงุฑุงุช - ุชุญุณูู OneSignal**

### **ุงูุชุญุณููุงุช ุงูููุทุจูุฉ:**
โ **ูุธุงู ุงูุฅุดุนุงุฑุงุช ูุฏุนู ุงูููุชุฑุฉ ุญุณุจ ุงููุฑุน ุจุงููุนู**

### **ุงููุธุงุฆู ุงููุชุงุญุฉ:**

#### **1. ุฅุฑุณุงู ุฅุดุนุงุฑ ูุฌููุน ุงููุณุชุฎุฏููู (ูุน ููุชุฑุฉ):**
```dart
static Future<Map<String, dynamic>> sendToAllUsers({
  required String title,
  required String message,
  String? branch, // ููุชุฑุฉ ุญุณุจ ุงููุฑุน
}) async {
  Query query = _db.collection(_usersCollection);
  
  if (branch != null && branch.isNotEmpty) {
    query = query.where('closestBranch', isEqualTo: branch);
  }
  
  // ุฌูุจ ุงููุณุชุฎุฏููู ูุฅุฑุณุงู ุงูุฅุดุนุงุฑุงุช
  // ...
}
```

#### **2. ุฅุฑุณุงู ุฅุดุนุงุฑ ููุณุชุฎุฏู ูุญุฏุฏ:**
```dart
static Future<Map<String, dynamic>> sendCustomNotificationToSpecificUser({
  required String phoneNumber,
  required String title,
  required String message,
}) async {
  // ุงูุจุญุซ ุนู ุงููุณุชุฎุฏู ุจุฑูู ุงููุงุชู
  // ุฅุฑุณุงู ุงูุฅุดุนุงุฑ
  // ...
}
```

### **ุงููุชูุฌุฉ:**
- โ ุฅุดุนุงุฑุงุช OneSignal ุชุนูู ุจุดูู ุตุญูุญ
- โ ููุชุฑุฉ ุญุณุจ ุงููุฑุน ูุชุงุญุฉ
- โ ุฅุฑุณุงู ููุณุชุฎุฏู ูุญุฏุฏ ูุชุงุญ
- โ ุฅุฑุณุงู ูุฌููุน ุงููุณุชุฎุฏููู ูุชุงุญ

---

## 6๏ธโฃ **ุงูุฅุญุตุงุฆูุงุช - ุฌุนููุง ูุงูุนูุฉ**

### **ุงูุชุญุณููุงุช:**
โ **ุชู ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช ูุชููู ูุชุทุงุจูุฉ ูุน ุงูุจูุงูุงุช ุงููุนููุฉ**

### **ุงูุชุบููุฑุงุช:**

#### **1. ุฅุญุตุงุฆูุงุช ุงููุณุชุฎุฏููู:**
```dart
// ูุจู ุงูุชุญุฏูุซ
_buildStatItem('ุงููุณุชุฎุฏููู ุงููุญุธูุฑูู', '${userStats['banned'] ?? 0}', Icons.block),

// ุจุนุฏ ุงูุชุญุฏูุซ
_buildStatItem('ุงููุณุชุฎุฏููู ุบูุฑ ุงููุดุทูู', '${userStats['inactive'] ?? 0}', Icons.person_off),
```

#### **2. ุฅุญุตุงุฆูุงุช ุงูุทูุจุงุช:**
```dart
// ูุจู ุงูุชุญุฏูุซ
_buildStatItem('ููุฏ ุงููุฑุงุฌุนุฉ', '${orderStats['pending'] ?? 0}', Icons.pending),
_buildStatItem('ููุฏ ุงูุชุฌููุฒ', '${orderStats['preparing'] ?? 0}', Icons.restaurant),
_buildStatItem('ููุฏ ุงูุชูุตูู', '${orderStats['delivering'] ?? 0}', Icons.delivery_dining),
_buildStatItem('ุชู ุงูุชูุตูู', '${orderStats['delivered'] ?? 0}', Icons.check_circle),

// ุจุนุฏ ุงูุชุญุฏูุซ (ูุชุทุงุจู ูุน ุงูุชุทุจูู ุงูุฑุฆูุณู)
_buildStatItem('ุฌุงุฑู ุงูุชุฌููุฒ', '${orderStats['preparing'] ?? 0}', Icons.access_time),
_buildStatItem('ุฌุงุฑู ุงูุชูุตูู', '${orderStats['delivering'] ?? 0}', Icons.delivery_dining),
_buildStatItem('ุชู ุงูุงุณุชูุงู', '${orderStats['delivered'] ?? 0}', Icons.check_circle),
_buildStatItem('ููุบู', '${orderStats['cancelled'] ?? 0}', Icons.cancel),
```

### **ุงููุชูุฌุฉ:**
- โ ุงูุฅุญุตุงุฆูุงุช ุชุนูุณ ุงูุจูุงูุงุช ุงูุญููููุฉ
- โ ูุชุทุงุจูุฉ ูุน ุงูุชุทุจูู ุงูุฑุฆูุณู
- โ ุชูุญุฏูุซ ุชููุงุฆูุงู ุญุณุจ ุงููุฑุน ุงููุฎุชุงุฑ

---

## ๐ **ุงูุฅุญุตุงุฆูุงุช ุงููุงูุนูุฉ**

### **ุงูููุชุฑุฉ ุญุณุจ ุงููุฑุน:**
ุฌููุน ุงูุฅุญุตุงุฆูุงุช ุงูุขู ุชุฏุนู ุงูููุชุฑุฉ ุญุณุจ ุงููุฑุน:

```dart
// ุฅุญุตุงุฆูุงุช ุงููุณุชุฎุฏููู
userController.loadUserStats(branch: selectedBranch);

// ุฅุญุตุงุฆูุงุช ุงูุทูุจุงุช
orderController.fetchStats(); // ุชูุญุฏูุซ ุชููุงุฆูุงู ุญุณุจ ุงููุฑุน

// ุฅุญุตุงุฆูุงุช ุงูููุชุฌุงุช
productController.stats; // ุชุนูู ุจุดูู ูุณุชูู
```

### **ุงูุฅุญุตุงุฆูุงุช ุงููุชุงุญุฉ:**

#### **ุงููุณุชุฎุฏููู:**
- ุฅุฌูุงูู ุงููุณุชุฎุฏููู
- ุงููุณุชุฎุฏููู ุงููุดุทูู
- ุงููุณุชุฎุฏููู ุบูุฑ ุงููุดุทูู
- ุงูุญุณุงุจุงุช ุงูุฌุฏูุฏุฉ

#### **ุงูุทูุจุงุช:**
- ุฅุฌูุงูู ุงูุทูุจุงุช
- ุฌุงุฑู ุงูุชุฌููุฒ
- ุฌุงุฑู ุงูุชูุตูู
- ุชู ุงูุงุณุชูุงู
- ููุบู

#### **ุงููุงููุฉ:**
- ุฅุฌูุงูู ุงูุฅูุฑุงุฏุงุช
- ูุชูุณุท ูููุฉ ุงูุทูุจ
- ุทูุจุงุช ุงูููู
- ุฅูุฑุงุฏุงุช ุงูููู

---

## ๐ฏ **ุงููุชูุฌุฉ ุงูููุงุฆูุฉ**

### โ **ุฌููุน ุงูุชุญุณููุงุช ููููุฐุฉ ุจูุฌุงุญ:**

| ุงูููุฒุฉ | ุงูุญุงูุฉ | ุงููุตู |
|--------|--------|-------|
| **ููุชุฑุฉ ุงููุณุชุฎุฏููู** | โ | ุญุณุจ ุงููุฑุน ุงููุฎุชุงุฑ |
| **ููุชุฑุฉ ุงูุทูุจุงุช** | โ | ุญุณุจ closestBranch |
| **ุฅุดุนุงุฑุงุช ูุฎุตุตุฉ** | โ | ุญุณุจ ุงููุฑุน ูู ุดุงุดุฉ ุงูููุชุฌุงุช |
| **ูุธุงู ุงููุฑุงุฌุนุฉ** | โ | ููุญุณุงุจุงุช ุงูุฌุฏูุฏุฉ |
| **OneSignal** | โ | ูุฏุนู ุงูููุชุฑุฉ ุญุณุจ ุงููุฑุน |
| **ุงูุฅุญุตุงุฆูุงุช** | โ | ูุงูุนูุฉ ููุชุทุงุจูุฉ |

---

## ๐ **ุงูุฎุทูุงุช ุงูุชุงููุฉ (ุงุฎุชูุงุฑูุฉ):**

### **1. ุฅูุดุงุก Firebase Indexes:**
ูุชุญุณูู ุงูุฃุฏุงุกุ ูููุตุญ ุจุฅูุดุงุก Indexes ูู Firebase Console:

```
Collection: users
Fields:
- closestBranch (Ascending)
- createdAt (Descending)

Collection: bills
Fields:
- closestBranch (Ascending)
- createdAt (Descending)
- status (Ascending)
```

### **2. ุงุฎุชุจุงุฑ ุดุงูู:**
- โ ุงุฎุชุจุงุฑ ุชุบููุฑ ุงููุฑุน
- โ ุงุฎุชุจุงุฑ ุฅุฑุณุงู ุงูุฅุดุนุงุฑุงุช
- โ ุงุฎุชุจุงุฑ ูุฑุงุฌุนุฉ ุงูุญุณุงุจุงุช
- โ ุงุฎุชุจุงุฑ ุงูุฅุญุตุงุฆูุงุช

### **3. ุชูุซูู ุฅุถุงูู:**
- โ ุฏููู ุงููุณุชุฎุฏู ููุฏุงุดุจูุฑุฏ
- โ ุฏููู ุฅุฏุงุฑุฉ ุงููุฑูุน
- โ ุฏููู ุฅุฑุณุงู ุงูุฅุดุนุงุฑุงุช

---

## ๐ **ููุงุญุธุงุช ูููุฉ:**

### **1. ุจููุฉ ุงูุจูุงูุงุช ูู Firebase:**
ุชุฃูุฏ ูู ุฃู ุฌููุน ุงููุณุชุฎุฏููู ูุงูุทูุจุงุช ูุฏููู ุญูู `closestBranch`:

```json
{
  "users": {
    "userId": {
      "name": "ุฃุญูุฏ",
      "phone": "07812345678",
      "closestBranch": "ุงูุบุฒุงููุฉ",
      // ...
    }
  },
  "bills": {
    "orderId": {
      "name": "ุฃุญูุฏ",
      "phone": "07812345678",
      "closestBranch": "ุงูุบุฒุงููุฉ",
      "status": 0,
      "orderstatus": "ุฌุงุฑู ุงูุชุฌููุฒ",
      // ...
    }
  }
}
```

### **2. ุงูููู ุงูุงูุชุฑุงุถูุฉ:**
- ุฅุฐุง ูู ููู ูุฏู ุงููุณุชุฎุฏู `closestBranch`ุ ุณูุธูุฑ ูู "ุงูุนุฑุงู"
- ุฅุฐุง ูู ููู ููุทูุจ `closestBranch`ุ ุณูุธูุฑ ูู "ุงูุนุฑุงู"

### **3. ุฃุฏุงุก ุงููุธุงู:**
- โ ุงูููุชุฑุฉ ุชุชู ุนูู ูุณุชูู Firebase (ุณุฑูุนุฉ)
- โ ุงูุชุฑุชูุจ ูุชู ูุญููุงู (ูุชุฌูุจ ูุดููุฉ Index ูุคูุชุงู)
- โ ุงูุชุญุฏูุซ ูุชู ุชููุงุฆูุงู ุนูุฏ ุชุบููุฑ ุงููุฑุน

---

**ุชุงุฑูุฎ ุงูุฅุตุฏุงุฑ:** 2025-10-10  
**ุงูุฅุตุฏุงุฑ:** 1.0.0  
**ุงูุญุงูุฉ:** โ **ุฌุงูุฒ ููุฅูุชุงุฌ**

